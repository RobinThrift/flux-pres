<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>What the Flux</title>
                <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700|Source+Code+Pro|Kaushan+Script">
        <link rel="stylesheet" href="styles/main.css">
    </head>
    <body>

        <div class="reveal">
            <div class="slides">
                <section
    class="slide "
     data-background="#cb5243" 
    
    
    
    
     data-notes="Or, a more important phylosophical question:" 
>
    <h1 id="-var-title-">What the Flux</h1>
<div class="author-info">
    <h5>Robin Thrift</h5>
    <h5>Jr. Dev, NewStore</h5>
    <a href="http://twitter.com/RobinThrift">@RobinThrift</a>
</div>
</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <h2 id="what-is-flux-">What is Flux?</h2>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <h3 id="-application-architecture-for-building-emphasize-user-interfaces-emphasize-">“Application Architecture for Building <span class="text--emphasize">User Interfaces</span>”</h3>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <h3 id="what-is-flux-trying-to-solve-">What is Flux trying to solve?</h3>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <h3 id="mvc">MVC</h3>
<p><img src="img/mvc1.svg" alt="img/mvc1.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <h3 id="mvc">MVC</h3>
<p><img src="img/mvc2.svg" alt="img/mvc2.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
     data-transition="slide-in none-out" 
    
>
    <p><img src="img/mvc3-1.svg" alt="img/mvc3-1.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
     data-transition="none-in slide-out" 
    
>
    <p><img src="img/mvc3-2.svg" alt="img/mvc3-2.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
     data-transition="slide-in none-out" 
    
>
    <p><img src="img/chat-0.svg" alt="img/chat-0.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
     data-transition="fade" 
    
>
    <p><img src="img/chat-1.svg" alt="img/chat-1.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
     data-transition="none-in slide-out" 
    
>
    <p><img src="img/chat-2.svg" alt="img/chat-2.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <p><img src="img/flux_overview.svg" alt="img/flux_overview.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <h2 id="-colour-hex-489541-the-dispatcher-colour-"><span style="color: #489541;">The Dispatcher</span></h2>
<p><img src="img/dispatcher-0.svg" alt="img/dispatcher-0.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <pre><code class="lang-typescript"><span class="hljs-interface"><span class="hljs-keyword">interface</span> Dispatcher </span>{
    register(fn: (action: Action) =&gt; <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span>;
    dispatch(action: Action): <span class="hljs-built_in">void</span>;
}
</code></pre>
<pre><code class="lang-typescript"><span class="hljs-keyword">type</span> Action = {
    actionType: Symbol,
    data: <span class="hljs-built_in">any</span>
}
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
     data-transition="slide-in none-out" 
    
>
    <p><img src="img/dispatcher-1.svg" alt="img/dispatcher-1.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
     data-transition="none-in slide-out" 
    
>
    <p><img src="img/dispatcher-2.svg" alt="img/dispatcher-2.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
    
     data-notes="- Stores many objects, not just one, like a model in MVC
- single domain
" 
>
    <h2 id="-colour-hex-74299f-stores-colour-"><span style="color: #74299F;">Stores</span></h2>
<p><img src="img/stores-0.svg" alt="img/stores-0.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
     data-transition="slide-in none-out" 
    
>
    <pre><code class="lang-typescript"><span class="hljs-interface"><span class="hljs-keyword">interface</span> Store </span>{
    dispatch(action: Action): <span class="hljs-built_in">void</span>;
}
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
     data-transition="none-in slide-out" 
    
>
    <pre><code class="lang-typescript"><span class="hljs-interface"><span class="hljs-keyword">interface</span> Store&lt;T&gt; </span>{
    <span class="hljs-keyword">public</span> dispatch(action: Action): <span class="hljs-built_in">void</span>;
    <span class="hljs-keyword">public</span> registerView(fn: (oldState: T, newState: T) =&gt; <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span>;
    <span class="hljs-keyword">private</span> notifyViews(): <span class="hljs-built_in">void</span>;
}
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <pre><code class="lang-typescript"><span class="hljs-keyword">class</span> UserStore extends Store&lt;User[]&gt; {
    <span class="hljs-comment">// ...</span>
    dispatch(action: Action) {
        <span class="hljs-keyword">switch</span> (action.actionType) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">'ADD_USER'</span>:
                <span class="hljs-comment">// ...</span>
            <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span>: <span class="hljs-string">'UPDATE_USER'</span>:
                <span class="hljs-comment">// ...</span>
            <span class="hljs-keyword">break</span>;
        }
    }
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<div class="fragment"><pre><code class="lang-typescript"><span class="hljs-keyword">import</span> dispatcher from <span class="hljs-string">'./localDispatcher'</span>;
<span class="hljs-keyword">let</span> userStore = <span class="hljs-keyword">new</span> UserStore();
dispatcher.register(userStore.dispatch);
</code></pre></div>

</section> 

                <section
    class="slide "
    
    
    
    
     data-transition="slide-in none-out" 
    
>
    <p>“[…] stores accept updates and reconcile them as appropriate […]”</p>
<p><div class="fragment">“[…] Stores have no direct setter methods […], but instead have only a single way of getting new data into their self-contained world.”</div></p>
<hr />

<small class="text--small"><a href="https://facebook.github.io/flux/docs/overview.html">https://facebook.github.io/flux/docs/overview.html</a></small>

</section> 

                <section
    class="slide "
    
    
    
    
     data-transition="none-in slide-out" 
    
>
    <p>“[…] stores accept updates and reconcile them as appropriate […]”</p>
<p>“[…] Stores have no direct setter methods […], but instead have only a single way of getting new data into their <span class="text--emphasize">self-contained world</span>.”</p>
<hr />

<small class="text--small"><a href="https://facebook.github.io/flux/docs/overview.html">https://facebook.github.io/flux/docs/overview.html</a></small>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <h3 id="stores-in-veer">Stores in Veer</h3>
<pre><code class="lang-typescript"><span class="hljs-keyword">class</span> Store&lt;T&gt; {
    <span class="hljs-constructor"><span class="hljs-keyword">constructor</span>(dispatcher) </span>{
        <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">this</span>.bindings = {
            <span class="hljs-comment">// ...</span>
        }
    }

    <span class="hljs-keyword">private</span> setState(newState: T) {
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-keyword">public</span> subscribe(sub) {
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <h3 id="veer-store-bindings">Veer store bindings</h3>
<pre><code class="lang-typescript"><span class="hljs-keyword">this</span>.bindings = {
    [CONSTANT]: <span class="hljs-keyword">this</span>.someMethod.bind(<span class="hljs-keyword">this</span>)
}

<span class="hljs-comment">// in store class</span>
<span class="hljs-keyword">set</span> bindings(newBindings) {
    <span class="hljs-keyword">this</span>._bindings = <span class="hljs-keyword">new</span> Map(newBindings);
}


dispatch({actionType, data}) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._bindings.has(actionType)) {
        <span class="hljs-keyword">this</span>._bindings.get(actionType)(data);
    }
}
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <pre><code class="lang-javascript"><span class="hljs-keyword">import</span> {Store} <span class="hljs-keyword">from</span> <span class="hljs-string">'veer/dist/store'</span>;
<span class="hljs-keyword">import</span> {SubredditConstants} <span class="hljs-keyword">from</span> <span class="hljs-string">'../constants/subreddits'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubredditStore</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Store</span> </span>{
    constructor(dispatcher) {
        <span class="hljs-keyword">super</span>(dispatcher);
        <span class="hljs-keyword">this</span>.setState([]);
        <span class="hljs-keyword">this</span>.bindings = {
            [SubredditConstants.GET_USER_SUBREDDITS]: 
                <span class="hljs-keyword">this</span>.takeDataAsIs.bind(<span class="hljs-keyword">this</span>)
        };
    }

    takeDataAsIs(data) {
        <span class="hljs-keyword">this</span>.setState(data);
    }
}
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <h2 id="-colour-hex-4a4a4a-views-colour-"><span style="color: #4A4A4A;">Views</span></h2>
<p><img src="img/views-0.svg" alt="img/views-0.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <pre><code class="lang-typescript">render() {
    <span class="hljs-keyword">return</span> (
        &lt;input <span class="hljs-keyword">type</span>=<span class="hljs-string">"text"</span> 
               value={<span class="hljs-keyword">this</span>.state.value} 
               onChange={<span class="hljs-keyword">this</span>._handleChange.bind(<span class="hljs-keyword">this</span>)} /&gt;
        &lt;ul&gt;  
            {<span class="hljs-keyword">this</span>.state.suggestions.map((s) =&gt; {
                <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">li</span>&gt;</span>{s}<span class="hljs-tag">&lt;/<span class="hljs-title">li</span>&gt;</span>;</span>
            })}
        &lt;/ul&gt;  
    );
}
</code></pre>
</section> 

                <section
    class="slide "
    
    
    
    
    
     data-notes="- but, not quite the React way
" 
>
    <pre><code class="lang-javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AutoComplete</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    _handleChange(event) {
        <span class="hljs-keyword">let</span> {value} = event.target;
        <span class="hljs-keyword">this</span>.setState({value});
        autoCompleteActions.createListForValue(value);
    }
    onStoreUpdate(oldState, newState) {
        <span class="hljs-keyword">this</span>.setState({suggestions: newState});
    }
    render() {
        <span class="hljs-comment">// prev slide</span>
    }
}
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
     data-notes="hands state down to children" 
>
    <pre><code class="lang-javascript">&lt;ConnectToStores stores={[StoreA, StoreB]}&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">AutoComplete</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">ConnectToStores</span>&gt;</span></span>
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <h4 id="connection-views-and-stores-in-veer">Connection views and stores in Veer</h4>
<pre><code class="lang-javascript">&lt;ConnectToStores stores={{storeAState: storeAInstance}}&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">OtherComponent</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">ConnectToStores</span>&gt;</span></span>
</code></pre>
<p><code>ConnectToStores</code> hands down the <code>stores</code> as idividual props and
handles the updates.</p>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <pre><code class="lang-javascript"><span class="hljs-keyword">import</span> React, {Component} <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;
<span class="hljs-keyword">import</span> {ConnectToStores} <span class="hljs-keyword">from</span> <span class="hljs-string">'veer/dist/components/connectToStores'</span>;
<span class="hljs-keyword">import</span> {SubredditStore} <span class="hljs-keyword">from</span> <span class="hljs-string">'../stores/subreddits'</span>;
<span class="hljs-keyword">import</span> {SubredditList} <span class="hljs-keyword">from</span> <span class="hljs-string">'./SubredditList/index'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserSubreddits</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    render() {
        <span class="hljs-keyword">let</span> stores = {
            subreddits: SubredditStore.getDefaultInstance()
        };
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">ConnectToStores</span> <span class="hljs-attribute">stores</span>=<span class="hljs-value">{stores}</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">SubredditList</span> {<span class="hljs-attribute">...this.props</span>} /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">ConnectToStores</span>&gt;</span>
        )</span>;
    }
}
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <pre><code class="lang-javascript"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubredditList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    <span class="hljs-comment">// ...</span>
    componentWillReceiveProps(nextProps) {
        <span class="hljs-comment">// ...</span>
    }
    <span class="hljs-comment">// ...</span>
}
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
     data-notes="- Actions are central to flux
- they propagate through the system
- carrying interactions/data
- are quite difficult
" 
>
    <h2 id="-colour-hex-ee6e45-actions-colour-"><span style="color: #EE6E45;">Actions</span></h2>
<p><img src="img/actions-0.svg" alt="img/actions-0.svg"></p>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <pre><code class="lang-typescript"><span class="hljs-keyword">type</span> Action = {
    actionType: Symbol,
    data: <span class="hljs-built_in">any</span>
}
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
     data-notes="But, if action in more than 1 view, this is tedious" 
>
    <pre><code class="lang-typescript"><span class="hljs-keyword">let</span> myAction = {
    actionType: UPDATE_STUFF,
    data: <span class="hljs-string">'Hello World'</span>
};

dispatcher.dispatch(myAction);
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
     data-notes="- Helper functions
- wrap actions
" 
>
    <h3 id="action-creators">Action Creators</h3>
<pre><code class="lang-typescript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateStuff</span>(<span class="hljs-params">data</span>) </span>{
    dispatcher.dispatch({
        actionType: UPDATE_STUFF,
        data: data
    });
}

<span class="hljs-comment">// ... somewhere down the line</span>
updateStuff(<span class="hljs-string">'Hello World'</span>);
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
     data-notes="- type safety
- usage of constants
" 
>
    <h3 id="action-types">Action Types</h3>
<pre><code class="lang-typescript"><span class="hljs-keyword">const</span> types = {
    TYPE_A: Symbol(), <span class="hljs-comment">// ES6/2015,</span>
    TYPE_B: <span class="hljs-string">'TYPE_B'</span> <span class="hljs-comment">// ES5</span>
};

<span class="hljs-comment">// TypeScript</span>
<span class="hljs-keyword">enum</span> types = {
    TYPE_A,
    TYPE B
};
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
     data-notes="- strings are unsafe
" 
>
    <h3 id="constants">Constants</h3>
<pre><code>src/
├── dispatcher<span class="hljs-class">.js</span>
├── actions/
├── constants/
│   └── todos<span class="hljs-class">.js</span>
└── components/
</code></pre><div class="fragment"><pre><code class="lang-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> TODO_CONSTANTS = {
    ADD_TODO: Symbol(), <span class="hljs-comment">// ES6/2015</span>
    UPDATE_TODO: <span class="hljs-string">'UPDATE_TODO'</span> <span class="hljs-comment">// ES5</span>
};
</code></pre></div>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <pre><code class="lang-typescript"><span class="hljs-keyword">import</span> TODO_CONSTANTS from <span class="hljs-string">'../constants/todos'</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateTodo</span>(<span class="hljs-params">todo</span>) </span>{
    dispatcher.dispatch({
        actionType: TODO_CONSTANTS.UPDATE_TODO,
        data: todo
    });
}

<span class="hljs-comment">// in a store</span>
dispatch(action: Action) {
    <span class="hljs-keyword">switch</span> (action.actionType) {
        <span class="hljs-keyword">case</span> TODO_CONSTANTS.ADD_TODO: <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span>: TODO_CONSTANTS.UPDATE_TODO: <span class="hljs-comment">// ...</span>
        <span class="hljs-keyword">break</span>;
    }
}
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <h3 id="constants-in-veer">Constants in Veer</h3>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> constantCreator <span class="hljs-keyword">from</span> <span class="hljs-string">'veer/dist/constantCreator'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> SubredditConstants = constantCreator([
    <span class="hljs-string">'GET_USER_SUBREDDITS'</span>,
    <span class="hljs-string">'GET_SUBREDDIT_LISTING'</span>
]);
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <h3 id="actions-in-veer">Actions in Veer</h3>
<pre><code class="lang-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> subredditActions = {
    getUserSubreddits() {
        <span class="hljs-comment">// ...</span>
        dispatcher.dispatch({
            actionType: SubredditConstants.GET_USER_SUBREDDITS,
            data: SOME_DATA
        });
    }
};
</code></pre>

</section> 

                <section
    class="slide "
    
    
    
    
    
    
>
    <h3 id="where-to-call-actions-">Where to call actions?</h3>
<pre><code class="lang-javascript"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PostList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
    componentWillReceiveProps(nextProps) {
        <span class="hljs-keyword">this</span>.setState({posts: nextProps.posts});
    }
    componentDidMount() {
        subredditActions
            .getSubredditListing(<span class="hljs-keyword">this</span>.props.name, <span class="hljs-keyword">this</span>.props.after);
    }
    onEndReached() {
        <span class="hljs-keyword">let</span> last = <span class="hljs-keyword">this</span>.state.posts.pop().id;
        subredditActions
            .getSubredditListing(<span class="hljs-keyword">this</span>.props.name, last);
    }
    render() {
        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">ListView</span>
                <span class="hljs-attribute">onEndReached</span>=<span class="hljs-value">{this.onEndReached.bind(this)}</span>
                <span class="hljs-attribute">...</span> /&gt;</span>
        )</span>;
    }
</code></pre>

</section> 

            </div>
        </div>
    
        <script src="scripts/head.min.js"></script>
        <script src="scripts/reveal.js"></script>
        <script>
        Reveal.initialize({"controls":true,"progress":true,"slideNumber":true,"history":true,"keyboard":true,"overview":true,"transition":"linear","backgroundTransition":"slide","showNotes":true,"dependencies":[{"src":"scripts/plugins/notes.js","async":true}]});
        </script>
    </body>
</html>
